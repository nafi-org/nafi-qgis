# -*- coding: utf-8 -*-
from pathlib import Path
from osgeo import gdal


def getColorTable(gdalDatasetPath):
    """Get the colour table from an image supported by GDAL."""
    assert isinstance(gdalDatasetPath, Path)

    dataset = gdal.Open(gdalDatasetPath.as_posix(), 1)

    assert dataset.RasterCount == 1, "Input raster for colour table must have 1 component"

    band = dataset.GetRasterBand(1)
    table = band.GetColorTable()
    result = table and [table.GetColorEntry(index) for index in range(256)]

    # clean GDAL up
    del band, dataset
    return result


def addColorTable(gdalDatasetPath):
    """Add the colour table to an image supported by GDAL."""
    assert isinstance(gdalDatasetPath, Path)

    dataset = gdal.Open(gdalDatasetPath.as_posix(), 1)

    assert dataset.RasterCount == 1, "Input raster for colour table must have 1 component"

    band = dataset.GetRasterBand(1)

    # create colour table
    colors = gdal.ColorTable()

    # load entries from default
    for index in range(256):
        colors.SetColorEntry(index, FIRESCAR_COLOR_TABLE[index])

    # set color table and color interpretation
    band.SetRasterColorTable(colors)
    band.SetRasterColorInterpretation(gdal.GCI_PaletteIndex)

    # close and save file
    del band, dataset


# exported from sample GeoTIFF via GDAL
FIRESCAR_COLOR_TABLE = [
    (0, 0, 0, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (130, 100, 130, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (110, 130, 165, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (55, 75, 55, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (70, 175, 145, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 153, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 255, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (51, 132, 51, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 255, 0, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 150, 75, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (255, 128, 255, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (160, 60, 160, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 255),
    (50, 0, 50, 0)
]
